{
  "name": "A-Inspector",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Slack Trigger').item.json.text }}\n{{ $('Slack Trigger').item.json.files[0].mimetype }}",
        "options": {
          "systemMessage": "=Rol\nEres un asistente de automatizaci√≥n conectado a Slack. Tu tarea es analizar imagenes y extraer los precios de los productos, asi como los producto de las fotos de los estantes.\n\nPara ello utilizas la herramienta `Imagen` a la cual le enviaras la url {{ $('Slack Trigger').item.json.files[0].url_private }} de la imagen a anlizar, debes enviar todas las solicitudes que tengan adjuntos una imagen y esperar a que te retorne el analisis.\n\nSi te saludan o te preguntan sobre tus cpacidades, responde con:\n¬°Hola! üëã Soy Luc√≠a, tu asistente de an√°lisis de productos. üõçÔ∏è\n\n¬øQu√© puedo hacer por ti?\n\nüì∏ EXTRACCI√ìN DE PRODUCTOS POR IMAGEN\nPuedo analizar im√°genes de estantes o productos para identificar y extraer toda la informaci√≥n relevante.\n\nEjemplos de solicitud:\n\"Por favor analiza los productos y precios de esta imagen de Tiendas 3B\"\n\"Extrae la informaci√≥n de los productos en esta foto de Aurrera Express\"\n\nüìç Importante: Siempre incluye el nombre de la tienda para que pueda contextualizar correctamente los productos.\n\nRetorna la informacion en el siguiente formato dentro de una etiqueda de codigo de slack en formato tabla ejemplo:\n\n#   PRODUCTO                                   PRECIO FOTO    \n--------------------------------------------------------------\nNombre de la categor√≠a                                  \n-------------------------------------------------------------- \n1   Nombre del producto                        $Precio del producto 0 NoEncontrado          \n2   Nombre del producto                        $Precio del producto 0 NoEncontrado         \n3   Nombre del producto                        $Precio del producto 0 NoEncontrado         \n4   Nombre del producto                        $Precio del producto 0 NoEncontrado        \n5   Nombre del producto                        $Precio del producto 0 NoEncontrado         \n6   Nombre del producto                        $Precio del producto 0 NoEncontrado   \n7   Nombre del producto                        $Precio del producto 0 NoEncontrado   \n8   Nombre del producto                        $Precio del producto 0 NoEncontrado   \n--------------------------------------------------------------\nNombre de la categor√≠a                                                     \n--------------------------------------------------------------\n9   Nombre del producto                        $Precio del producto 0 NoEncontrado         \n10  Nombre del producto                        $Precio del producto 0 NoEncontrado        \n11  Nombre del producto                        $Precio del producto 0 NoEncontrado    \n--------------------------------------------------------------  \n\n¬øListo para analizar algunos productos? ¬°Solo comparte tu imagen mencionando la tienda! üòä\n\n\nNunca pongas el termino slack dentro del componente codigo de slack como en este ejemplo:\n\nslack\n#   PRODUCTO                                    PRECIO FOTO    \n--------------------------------------------------------------\nCosm√©ticos - Maquillaje                                  \n-------------------------------------------------------------- \n1   Ecco Bella Polvo Compacto Matificante          $35.00        \n2   Ecco Bella Rubor Compacto                      $35.00        \n3   Bausse Rubor L√≠quido                           $25.00        \n4   Bausse Sombras para ojos 'Lost in the desert'  $35.00        \n5   Ecco Bella Esmalte para u√±as                   No Encontrado         \n6   Bausse Polvo Sellador Banana                   $45.00    \n7   Bausse Paleta Iluminadores                     $45.00    \n8   Ecco Bella Labial Larga Duraci√≥n (Matte)       $29.00  \n--------------------------------------------------------------\nCuidado Personal y Accesorios                                                     \n-------------------------------------------------------------- \n9   Ecco Bella Esponja con Jab√≥n Concha Nacar      $10.00        \n10  Ecco Bella Esponja con Jab√≥n Facial Carbon     $10.00        \n11  Blender (Esponja de maquillaje)                No Encontrado    \n--------------------------------------------------------------  \nMedicamentos                                          \n-------------------------------------------------------------- \n12  Aspirina                                      $54.00        \n13  Cafiaspirina                                  No Encontrado       \n14  Ibuprofeno                                    $19.00        \n15  Ibuprofeno Fuerte                             $22.00        \n\ny coloca los productos NoEncontrados al final de cada categor√≠a."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -192,
        0
      ],
      "id": "71a63bad-64be-41bf-be48-4e9d87e476b9",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -256,
        208
      ],
      "id": "34f967de-3583-44e3-816a-ddcdbdc72032",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "FAK9ncdTs0r5RJkd",
          "name": "A-Lucia"
        }
      }
    },
    {
      "parameters": {
        "description": "Usa esta herramienta para analizar im√°genes, y retorna toda la informaci√≥n completa",
        "workflowId": {
          "__rl": true,
          "value": "afvGWEJPx2vX1TrB",
          "mode": "list",
          "cachedResultUrl": "/workflow/afvGWEJPx2vX1TrB",
          "cachedResultName": "Inspector #A-Imagen"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "url": "={{ $('Slack Trigger').item.json.files[0].url_private }}",
            "userId": "={{ $('Slack Trigger').item.json.files[0].user }}",
            "empresa": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('empresa', ``, 'string') }}",
            "id_sesion": "={{ $('Slack Trigger').item.json.ts }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "userId",
              "displayName": "userId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "empresa",
              "displayName": "empresa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "id_sesion",
              "displayName": "id_sesion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        48,
        208
      ],
      "id": "d9d0a32f-fa1e-4d2b-8345-1fd64da4db38",
      "name": "Imagen"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "={{ $('Slack Trigger').item.json.channel }}",
          "mode": "id"
        },
        "text": "={{ $('AI Agent').item.json.output }}",
        "otherOptions": {
          "includeLinkToWorkflow": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        368,
        0
      ],
      "id": "8cf7b0ad-7e1a-42e7-9d23-c91bef4e5e12",
      "name": "Send a message",
      "webhookId": "180dbcc2-55e4-4e18-a1de-a5b15c7acb6f",
      "credentials": {
        "slackApi": {
          "id": "KeRz8uv4jvr2vGMf",
          "name": "Slack#A-Inspector"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "projectId": {
          "__rl": true,
          "value": "neto-cloud",
          "mode": "list",
          "cachedResultName": "Neto-Cloud",
          "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=neto-cloud"
        },
        "sqlQuery": "{{ $fromAI('query') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleBigQueryTool",
      "typeVersion": 2.1,
      "position": [
        496,
        208
      ],
      "id": "ac019c3c-4fe1-48d7-848a-f43dd9409e88",
      "name": "ExecuteQuery",
      "credentials": {
        "googleApi": {
          "id": "BrAyOfCNy2JTszLb",
          "name": "Google Service Account account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "description": "Usa esta herramienta cuando necesites un uuid univoco e irrepetible",
        "workflowId": {
          "__rl": true,
          "value": "D5LxxphpWPFdg6dg",
          "mode": "list",
          "cachedResultUrl": "/workflow/D5LxxphpWPFdg6dg",
          "cachedResultName": "uuid#A-Precios"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        160,
        208
      ],
      "id": "0f0209df-1204-44fb-a754-5d3391cc8669",
      "name": "uuid",
      "disabled": true
    },
    {
      "parameters": {
        "description": "Usa esta herramienta para obtener los datos del usuario.",
        "workflowId": {
          "__rl": true,
          "value": "j7iJeUrVWsLQTW9A",
          "mode": "list",
          "cachedResultUrl": "/workflow/j7iJeUrVWsLQTW9A",
          "cachedResultName": "ObtenerDatosUsuario#A-Precios"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "userId": "={{ $('Slack Trigger').item.json.user }}"
          },
          "matchingColumns": [
            "userId"
          ],
          "schema": [
            {
              "id": "userId",
              "displayName": "userId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        288,
        208
      ],
      "id": "9d5083ae-c1ec-4841-888c-21f2c380efa3",
      "name": "ObtenerDatosUsuario",
      "disabled": true
    },
    {
      "parameters": {
        "resource": "reaction",
        "channelId": {
          "__rl": true,
          "value": "={{ $json.channel }}",
          "mode": "id"
        },
        "timestamp": "={{ $json.ts }}",
        "name": "eyes"
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        -464,
        0
      ],
      "id": "5f4b9745-a7b2-4f83-89bb-e5c1c584d1d9",
      "name": "Add a reaction",
      "webhookId": "2f0093d6-bb30-40f2-9c48-9f0b842f1522",
      "credentials": {
        "slackApi": {
          "id": "KeRz8uv4jvr2vGMf",
          "name": "Slack#A-Inspector"
        }
      }
    },
    {
      "parameters": {
        "resource": "reaction",
        "operation": "remove",
        "channelId": {
          "__rl": true,
          "value": "={{ $('Slack Trigger').item.json.channel }}",
          "mode": "id"
        },
        "timestamp": "={{ $('Slack Trigger').item.json.ts }}",
        "name": "eyes"
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        160,
        0
      ],
      "id": "e3dfcefc-558f-48b0-b03f-2418769f016a",
      "name": "Remove a reaction",
      "webhookId": "83355261-73b1-491f-b1e6-b4ff7ad5cd7a",
      "credentials": {
        "slackApi": {
          "id": "KeRz8uv4jvr2vGMf",
          "name": "Slack#A-Inspector"
        }
      }
    },
    {
      "parameters": {
        "resource": "reaction",
        "channelId": {
          "__rl": true,
          "value": "={{ $json.channel }}",
          "mode": "id"
        },
        "timestamp": "={{ $json.message.ts }}",
        "name": "white_check_mark"
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        576,
        0
      ],
      "id": "7f2fedd6-ef2d-4f7d-813e-4d06d56f7674",
      "name": "Add a reaction1",
      "webhookId": "1e8e613e-a802-4aae-b93d-5c1698498eed",
      "credentials": {
        "slackApi": {
          "id": "KeRz8uv4jvr2vGMf",
          "name": "Slack#A-Inspector"
        }
      }
    },
    {
      "parameters": {
        "trigger": [
          "message"
        ],
        "watchWorkspace": true,
        "options": {
          "resolveIds": true,
          "userIds": [
            "U093XJ4EY5A",
            "U09GHGTKSL8",
            "U09GZHNV8UQ",
            "U099C6HKQJY",
            "U0950KQEB7H",
            "U0968SYAHKP"
          ]
        }
      },
      "type": "n8n-nodes-base.slackTrigger",
      "typeVersion": 1,
      "position": [
        -672,
        0
      ],
      "id": "5af4e5e1-a038-453b-ae44-1bede14a652a",
      "name": "Slack Trigger",
      "webhookId": "030afa99-adb4-40ac-9bdc-3680e58bc724",
      "credentials": {
        "slackApi": {
          "id": "KeRz8uv4jvr2vGMf",
          "name": "Slack#A-Inspector"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "0jVy3dajeP8yXj3D",
          "mode": "list",
          "cachedResultUrl": "/workflow/0jVy3dajeP8yXj3D",
          "cachedResultName": "Mandar logs a bquery"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "execution id": "={{ $execution.id }}",
            "id slack": "={{ $('Slack Trigger').item.json.user }}",
            "Nombre_agente": "A-Luc√≠a",
            "input": "={{ $('Slack Trigger').item.json.text }}",
            "output_agente": "an√°lisis"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "execution id",
              "displayName": "execution id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "id slack",
              "displayName": "id slack",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "Nombre_agente",
              "displayName": "Nombre_agente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "input",
              "displayName": "input",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "output_agente",
              "displayName": "output_agente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": false
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        768,
        0
      ],
      "id": "13029c20-e7b1-4ba1-86d1-9dbe341be7a7",
      "name": "Call 'Mandar logs a bquery'"
    }
  ],
  "pinData": {
    "Slack Trigger": [
      {
        "json": {
          "type": "message",
          "text": "Analiza los productos de la siguiente imagen de las tiendas 3B",
          "files": [
            {
              "id": "F0A0ENAQ7NC",
              "created": 1764020938,
              "timestamp": 1764020938,
              "name": "IMG_6576 (1).jpg",
              "title": "IMG_6576 (1).jpg",
              "mimetype": "image/jpeg",
              "filetype": "jpg",
              "pretty_type": "JPEG",
              "user": "U091B7WDXJ4",
              "user_team": "T9XJE11PE",
              "editable": false,
              "size": 2826846,
              "mode": "hosted",
              "is_external": false,
              "external_type": "",
              "is_public": false,
              "public_url_shared": false,
              "display_as_bot": false,
              "username": "",
              "url_private": "https://files.slack.com/files-pri/T9XJE11PE-F0A0ENAQ7NC/img_6576__1_.jpg",
              "url_private_download": "https://files.slack.com/files-pri/T9XJE11PE-F0A0ENAQ7NC/download/img_6576__1_.jpg",
              "media_display_type": "unknown",
              "thumb_64": "https://files.slack.com/files-tmb/T9XJE11PE-F0A0ENAQ7NC-2d425fec4a/img_6576__1__64.jpg",
              "thumb_80": "https://files.slack.com/files-tmb/T9XJE11PE-F0A0ENAQ7NC-2d425fec4a/img_6576__1__80.jpg",
              "thumb_360": "https://files.slack.com/files-tmb/T9XJE11PE-F0A0ENAQ7NC-2d425fec4a/img_6576__1__360.jpg",
              "thumb_360_w": 270,
              "thumb_360_h": 360,
              "thumb_480": "https://files.slack.com/files-tmb/T9XJE11PE-F0A0ENAQ7NC-2d425fec4a/img_6576__1__480.jpg",
              "thumb_480_w": 360,
              "thumb_480_h": 480,
              "thumb_160": "https://files.slack.com/files-tmb/T9XJE11PE-F0A0ENAQ7NC-2d425fec4a/img_6576__1__160.jpg",
              "thumb_720": "https://files.slack.com/files-tmb/T9XJE11PE-F0A0ENAQ7NC-2d425fec4a/img_6576__1__720.jpg",
              "thumb_720_w": 540,
              "thumb_720_h": 720,
              "thumb_800": "https://files.slack.com/files-tmb/T9XJE11PE-F0A0ENAQ7NC-2d425fec4a/img_6576__1__800.jpg",
              "thumb_800_w": 800,
              "thumb_800_h": 1067,
              "thumb_960": "https://files.slack.com/files-tmb/T9XJE11PE-F0A0ENAQ7NC-2d425fec4a/img_6576__1__960.jpg",
              "thumb_960_w": 720,
              "thumb_960_h": 960,
              "thumb_1024": "https://files.slack.com/files-tmb/T9XJE11PE-F0A0ENAQ7NC-2d425fec4a/img_6576__1__1024.jpg",
              "thumb_1024_w": 768,
              "thumb_1024_h": 1024,
              "original_w": 4284,
              "original_h": 5712,
              "thumb_tiny": "AwAwACSS4ULHuXYoz12g/wCe1QRtliSyMuP7g6/l7U952Lny1O3gKSDye9IskvzA54HB25wf8/zpJDuSAsnYA45IAFMNy+0/PxuIyAP896C0qFd65Ddznj8qYshY5KheOzZ/madh3HeewJBlPBxkIDml+0H/AJ6t/wB+x/jTAszjKBiOmRxS+Vcf3W/OkVddioQzEElefRgKftiJOMEY43MAc05lQg72XeT15HH4ChzEu/DKd3TII7fT39qZA1kGcYUYHqv+NKIyW2rsGD2YEn9aB5aMQ3lsMYA5H64/z600KoYYYbsds+tAFh2ZWw0twCOuB/8AXpu//prc/wDfJ/xp6yoAMzzZ74J4pfOj/wCe8/5mgLsiiVxCSVB7DtSbWaURgYYjnB4/lT90pGMcAdDg0LvVQFXoMZzQIjdDF8m07TycHP8ASm/JvAKnrySf/rVLKJZDnOD7mm+S5I3Adc0AvMQSrjiOQ/R8f0o8xf8AnlL/AN/P/rVMYgesan8KPKX/AJ5p+VGoH//Z",
              "permalink": "https://tiendasnetocorpo.slack.com/files/U091B7WDXJ4/F0A0ENAQ7NC/img_6576__1_.jpg",
              "permalink_public": "https://slack-files.com/T9XJE11PE-F0A0ENAQ7NC-d73c6e9f91",
              "skipped_shares": true,
              "has_rich_preview": false,
              "file_access": "visible"
            }
          ],
          "upload": false,
          "user": "U091B7WDXJ4",
          "display_as_bot": false,
          "blocks": [
            {
              "type": "rich_text",
              "block_id": "HDYFs",
              "elements": [
                {
                  "type": "rich_text_section",
                  "elements": [
                    {
                      "type": "text",
                      "text": "Analiza los productos de la siguiente imagen de las tiendas 3B"
                    }
                  ]
                }
              ]
            }
          ],
          "ts": "1764020954.187319",
          "client_msg_id": "0c3b2b15-991e-429e-b210-472f3e1fb213",
          "channel": "D09FQATP1T8",
          "subtype": "file_share",
          "event_ts": "1764020954.187319",
          "channel_type": "im",
          "user_resolved": "juan.garciag"
        }
      }
    ]
  },
  "connections": {
    "AI Agent": {
      "main": [
        [
          {
            "node": "Remove a reaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Imagen": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Send a message": {
      "main": [
        [
          {
            "node": "Add a reaction1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ExecuteQuery": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "uuid": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "ObtenerDatosUsuario": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Add a reaction": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Remove a reaction": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Slack Trigger": {
      "main": [
        [
          {
            "node": "Add a reaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add a reaction1": {
      "main": [
        [
          {
            "node": "Call 'Mandar logs a bquery'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "c60db28d-b8d1-4f4f-8428-2b0ebd7de941",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "513b8468f38706db87bc69e329565f9d7c7508c065cd8491cb3b8e0d8f69afa3"
  },
  "id": "c6kUD9vhgFNBVBxf",
  "tags": []
}